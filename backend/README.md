# Chat backend

This is the module with the WebSocket server needed to communicate with the frontend layer. Only the minimum viable to run locally and meet the necessary features of the frontend layer has been developed.

## Technologies

- [Node.js](https://github.com/nodejs/node) is the platform used for the development and execution of this server.
- [express](https://github.com/expressjs/express) is a library used that allows the creation of web servers, where the WebSocket is available.
- [socket.io](https://github.com/socketio/socket.io) is a library that allows real-time communications, such as WebSocket for example.
- [uuid](https://github.com/uuidjs/uuid) is a library used for the creation of a Universally Unique Identifier (UUID).
- [nodemon](https://github.com/remy/nodemon) is a development tool that hot reloads the changes in the server code.

## Features

### Connection
When a new connection is received on the server, it sends a message on the `chat.join` channel to the client informing the connection identifier, which is already provided by the socket.io library.

### Sending and receiving messages
The server listens to events for when a message is sent on the `chat.send` channel, this is the channel that receives messages sent by clients in the chat.

The message sent to the channel must have these following attributes:
- `userName` is the user name that should be displayed in the message for other clients.
- `text` is the content of the message to be sent.

When the server receives the message on the `chat.send` channel, it broadcasts it to all connected clients (including the person who sent the message) on the `chat.receive` channel by sending an object with the following attributes:
- `id` is the identifier generated by the UUID library to be a unique identifier for the message.
- `text` is the content of the message.
- `userId` is the identifier of the user who sent the message (connection identifier from socket.io).
- `userName` is the name of the user who sent the message.
- `dateTime` is the string with the date in ISO 8601 format, with the current time of the server;

## Getting started
Before executing the commands, make sure that you are using the necessary versions specified in the root requirements section.

The commands must be executed in the **backend** module directory.

You can access the folder via terminal, at the root of the repository, run in the terminal:

```sh
cd backend
```

#### Running Locally
After you clone the project, perform the following steps to run the project locally.

By default, this server will use port `8080, if you need to change this port, change it directly in the [server code](src/server.js).

In a terminal window, install and start the server:

```sh
# Install the dependencies
yarn install

# Start local development
yarn start

# open http://localhost:3000 to view it in the browser.
# the server will reload if you make edits
# errors will show up in the console
```

## Improvements

### Unsaved messages
The server does not store any messages, if any messages were sent before another user connected, they won't be able to see the message sent.

A possible solution is to save messages sent in somewhere (memory or in a database), and whenever a user connects to the server, send all messages in addition to the user ID.

### Build
Prepare the server for distribution, now it's only configured to run locally.

A good alternative would be to use [PM2](https://github.com/Unitech/pm2) to run the server, in addition to distributing it with a docker image that would facilitate execution in several different environments.

Another important point would also be to parameterize the server port configuration via an environment variable, suggestion for use would be the [dotenv](https://github.com/motdotla/dotenv) library or just retrieve directly from the Node.js process (e.g: `process.env.WS_SERVER_PORT`).
